/*
 * Host definitions with object attributes
 * used for apply rules for Service, Notification,
 * Dependency and ScheduledDowntime objects.
 *
 * Tip: Use `icinga2 object list --type Host` to
 * list all host objects after running
 * configuration validation (`icinga2 daemon -C`).
 */

/*
 * This is an example host based on your
 * local host's FQDN. Specify the NodeName
 * constant in `constants.conf` or use your
 * own description, e.g. "db-host-1".
 */

object Host "{{ inventory_hostname }}" {
  /* Import the default host template defined in `templates.conf`. */
  import "generic-host"
  display_name = "{{ icinga2_display_name }}"  

  vars.swap_check = true
  vars.client_endpoint = name

  /* Monitor Backup ninja*/
  vars.has_backupninja = true

  /* Specify the address attributes for checks e.g. `ssh` or `http`. */
  address = "{{ icinga2_ipv4_address }}"
  address6 = "{{ icinga2_ipv6_address }}"

  /* Set custom attribute `os` for hostgroup assignment in `groups.conf`. */
  vars.os = "Linux"

  /* Define disks and attributes for service apply rules in `services.conf`. */
  vars.disks["disk"] = {
    /* No parameters. */
  }
  vars.disks["disk /"] = {
    disk_partitions = "/"
  }

{% if inventory_hostname not in groups['kvm-servers'] %}
  /* Define http vhost attributes for service apply rules in `services.conf`. */
  vars.http_vhosts["https"] = {
    http_uri = "/"
    http_ssl = true
{% if icinga2_http_host %}
    http_vhost = "{{ icinga_http_host }}"
{% endif %} 
  }
{% endif %}

{% if inventory_hostname not in groups['kvm-servers'] %}
  /* Mysql Monitoring*/
  vars.mysql_hostname = "localhost"
{% endif %}

{% if inventory_hostname in groups['kvm-servers'] %}
  /* Set a custom value for procs warning */
  vars.procs_warning = {{ icinga2_server_warning_procs }}
  vars.procs_critical = {{ icinga2_server_critical_procs }}

  check_command = "zpool"
{% endif %}

  /* Define notification mail attributes for notification apply rules in `notifications.conf`. */
  vars.notification["mail"] = {
    /* The UserGroup `icingaadmins` is defined in `users.conf`. */
    groups = [ "icingaadmins" ]
  }
}
